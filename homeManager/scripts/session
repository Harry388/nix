#!/usr/bin/env bash

dirs=(
    "$HOME" "$HOME/work" "$HOME/programming"
    "$HOME/programming/js" "$HOME/programming/zig" "$HOME/programming/rust"
    "$HOME/programming/gleam" "$HOME/programming/golang" "$HOME/programming/elixir"
)
dir=$(find "${dirs[@]}" -maxdepth 1 -mindepth 1 -type d ! -path "*/.*" 2> /dev/null | fzf)
if [ -n "$dir" ]; then
    name=$(basename "$dir")
    if ! tmux has-session -t "$name"; then
        tmux new-session -c "$dir" -s "$name" -d
        if [ -f "$dir/.session" ]; then
            tmux send-keys -t "$name" "source $dir/.session $name" c-M
        elif [ -f "$HOME/nix/homeManager/scripts/.session" ]; then
            tmux send-keys -t "$name" "source $HOME/nix/homeManager/scripts/.session $name" c-M
        fi
    fi
    if [ -n "$TMUX" ]; then
        tmux switch -t "$name"
    else
        tmux attach -t "$name"
    fi
fi
